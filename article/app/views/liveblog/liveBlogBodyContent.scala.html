@(model: LiveBlogPage, amp: Boolean = false)(implicit request: RequestHeader)

@import common.Edition
@import views.support.AmpAd

@defining((model.article, Edition(request).timezone)) { case (article, timezone) =>
    <div class="js-article__container" data-component="body">
        @if(!amp) {
            <div class="toast__space-reserver">
                <div id="toast__tofix" class="toast__container">
                    <button class="toast__button toast__button--closed button button--large">
                        <span class="toast__text"></span>
                        @fragments.inlineSvg("refresh", "icon", List(""))
                    </button>
                </div>
            </div>
        }
        @if(model.currentPage.currentPage.isArchivePage) {
            @fragments.liveBlogNavigation(article.content.metadata.id, model.currentPage)
        }
        <div class="js-liveblog-body u-cf from-content-api js-blog-blocks blocks @if(article.fields.isLive) {live-blog}" data-most-recent-block="block-@{
            _root_.liveblog.LatestBlock(article.blocks)
        }" data-test-id="live-blog-blocks"
        itemprop="@if(article.tags.isReview) {reviewBody} else {articleBody}">
            @if(amp) {
                @model.currentPage.currentPage.blocks.sliding(5, 5).zipWithIndex.map { case (blockGroup, index) =>
                    @views.html.liveblog.liveBlogBlocks(blockGroup, article, timezone, amp)

                    @* Add advert every 5 blog posts, up to a maximum of 8 *@
                    @if(blockGroup.length == 5 && index < 8) {
                        <div class="block amp-ad-container amp-ad-container--live-blog">
                            <amp-ad width="300" height="250" type="doubleclick"
                            json=@AmpAd.buildJsonString(article, request.path, Edition(request).id.toLowerCase())
                            data-slot=@AmpAd.buildDataSlot(article)>
                            </amp-ad>
                        </div>
                    }
                }
            } else {
                @views.html.liveblog.liveBlogBlocks(model.currentPage.currentPage.blocks, article, timezone, amp)
            }
        </div>
        @* Remove LiveFilter and the fragment once Toast comes out of AB test status *@
        @fragments.liveBlogNavigation(article.content.metadata.id, model.currentPage)
    </div>

    @fragments.submeta(article)

    <div class="after-article js-after-article"></div>

    <div class="js-bottom-marker"></div>
}
